from config.settings import OPENAI_API_KEY

try:
    from openai import OpenAI  # openai>=1.0
except Exception:
    OpenAI = None  # type: ignore[assignment]


async def ask_ai(prompt: str) -> str:
    """–ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø–æ–º–æ—â–Ω–∏–∫: –ø—Ä–æ—Å–∏—Ç –º–æ–¥–µ–ª—å –¥–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π —Å–æ–≤–µ—Ç –ø–æ –ø—Ä–∏–≤—ã—á–∫–∞–º.

    –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ openai –∏ –∑–∞–¥–∞–Ω OPENAI_API_KEY.
    –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–≥–ª—É—à–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç, —á—Ç–æ–±—ã –±–æ—Ç –Ω–µ –ø–∞–¥–∞–ª.
    """
    if not OPENAI_API_KEY or OpenAI is None:
        # –§–æ–ª–ª–±–µ–∫ –±–µ–∑ –ò–ò ‚Äî –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
        return (
            "–°–µ–π—á–∞—Å –ò–ò –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–∞–º–∏ –≤—ã–±—Ä–∞—Ç—å –º–∞–ª–µ–Ω—å–∫—É—é –ø—Ä–∏–≤—ã—á–∫—É –∏ "
            "–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –µ—ë –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üôÇ"
        )

    try:
        client = OpenAI(api_key=OPENAI_API_KEY)

        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": (
                        "–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–∏–≤—ã—á–µ–∫. –û—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ, –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏ –∏ –ø–æ-—Ä—É—Å—Å–∫–∏. "
                        "–í—Å–µ–≥–¥–∞ –¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, –≤—ã–ø–æ–ª–Ω–∏–º–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è."
                    ),
                },
                {"role": "user", "content": prompt},
            ],
            max_tokens=200,
        )

        message = response.choices[0].message.content
        return message or "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–π –º–∞–ª–µ–Ω—å–∫–æ–π –ø—Ä–∏–≤—ã—á–∫–µ —Å–µ–≥–æ–¥–Ω—è."
    except Exception:
        # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –Ω–µ –¥–∞—ë–º –±–æ—Ç—É —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏
        return (
            "–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç–æ–π —Ü–µ–ª–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: "
            "—Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –ø–æ–ª–µ–∑–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ."
        )
